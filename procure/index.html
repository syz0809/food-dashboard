<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>采购管理 · 数字菜品库</title>

  <!-- 复用首页样式（如有） -->
  <link rel="stylesheet" href="../index/style.css">
  <!-- 本页样式 -->
  <link rel="stylesheet" href="./procure.css">
</head>
<body>
  <!-- 顶部：保持与前两页一致 + 小优化 -->
  <header class="topbar">
    <div class="container">
      <nav class="nav">
        <div class="brand" aria-label="品牌">
          <div class="logo" aria-hidden="true">囊</div>
          <div>新疆味·云台</div>
        </div>
        <div class="nav-links" role="navigation" aria-label="主导航">
          <a href="../index/index.html">菜品云台</a>
          <a href="../adjust/index.html">菜品调整</a>
          <a class="active" href="./">采购管理</a>
        </div>
        <div class="nav-tools">
          <div class="input" role="search">
            <span aria-hidden="true">🔎</span>
            <input id="q" placeholder="搜索物料/供应商/类别…" aria-label="搜索" />
          </div>
          <input id="datePicker" type="date" class="date" aria-label="业务日期" />
          <button class="btn" id="syncBtn" type="button">同步数据</button>
        </div>
      </nav>
    </div>
  </header>

  <main class="container main main--procure" aria-live="polite">
    <!-- 左侧：物料清单 + 过滤 -->
    <aside class="card left-col" aria-label="物料清单">
      <h3 class="title">物料清单</h3>

      <div class="filter-group">
        <div class="label">分类</div>
        <div id="catBar" class="pill-bar" role="tablist" aria-label="分类筛选"></div>
      </div>

      <div class="filter-group">
        <div class="label">供应商</div>
        <div id="vendorBar" class="pill-bar" role="tablist" aria-label="供应商筛选"></div>
      </div>

      <div class="filter-group">
        <div class="label">安全库存阈值</div>
        <div class="seg" id="safetySeg" role="group" aria-label="安全库存阈值">
          <button data-level="all" class="on" type="button">低/中/高</button>
          <button data-level="low" type="button">低</button>
          <button data-level="mid" type="button">中</button>
          <button data-level="high" type="button">高</button>
        </div>
      </div>

      <div id="matList" class="mat-list" aria-label="物料列表"></div>
    </aside>

    <!-- 中列：采购预测（折线 + KPI） -->
    <section class="card mid-col" aria-label="采购预测">
      <div class="section-head">
        <h3 class="title">采购预测</h3>
        <small class="muted">基于近14天销量与到货周期（点击物料“查看预测”联动）</small>
      </div>
      <canvas id="fcLine" class="miniChart" height="260" aria-label="汇总预测曲线"></canvas>

      <!-- KPI 三联 -->
      <div class="kpis kpis-3">
        <div class="kpi">
          <div class="label">建议采购量（7天）</div>
          <div id="kpiSuggest" class="kpi-num">—</div>
        </div>
        <div class="kpi">
          <div class="label">预计缺口</div>
          <div id="kpiGap" class="kpi-num">—</div>
        </div>
        <div class="kpi">
          <div class="label">平均到货周期（天）</div>
          <div id="kpiLead" class="kpi-num">—</div>
        </div>
      </div>
    </section>

    <!-- 右列：待采购清单 -->
    <section class="card right-col" aria-label="待采购清单">
      <div class="section-head">
        <h3 class="title">待采购清单</h3>
        <div class="actions">
          <button id="btnGenPO" class="btn btn-primary" type="button">生成采购单</button>
          <button id="btnClearPO" class="btn" type="button">清空</button>
        </div>
      </div>
      <div class="po-head">
        <span>物料</span><span>供应商</span><span>现库存</span><span>安全库存</span><span>预测 7 天</span><span>到货周期(天)</span><span>建议采购</span><span>操作</span>
      </div>
      <div id="poList" class="po-list"></div>
      <div class="po-foot" id="poFoot"></div>
    </section>
  </main>

  <!-- 预测详情浮窗 -->
  <div id="md" class="modal hide">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="mdTitle">
      <div class="dialog__hd">
        <b id="mdTitle">预测详情</b>
        <button id="mdClose" class="x" type="button" aria-label="关闭">✕</button>
      </div>

      <div class="dialog__bd md-grid">
        <div class="md-col">
          <div class="md-row"><label>物料</label><div id="mdName" class="md-val">—</div></div>
          <div class="md-row"><label>供应商</label><div id="mdVendor" class="md-val">—</div></div>
          <div class="md-row"><label>分类</label><div id="mdCat" class="md-val">—</div></div>
          <div class="md-row"><label>现库存</label><div id="mdStock" class="md-val">—</div></div>
          <div class="md-row"><label>安全库存</label><div id="mdSafety" class="md-val">—</div></div>
          <div class="md-row"><label>到货周期(天)</label><div id="mdLead" class="md-val">—</div></div>
          <div class="md-row"><label>AI 建议</label><ul id="mdAdvice" class="sug"></ul></div>
        </div>

        <div class="md-col">
          <div class="md-row"><label>最近销量（7 天）</label>
            <div id="mdSales7" class="muted">—</div>
            <canvas id="mdSales7Line" class="miniChart" height="120"></canvas>
          </div>
          <div class="md-row"><label>历史（14 天）</label>
            <canvas id="mdFc14" class="miniChart" height="160"></canvas>
          </div>
        </div>
      </div>

      <div class="dialog__ft">
        <button id="mdAdd" class="btn btn-primary" type="button">加入待采购</button>
        <button id="mdCancel" class="btn" type="button">关闭</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- 脚本 -->
  <script defer src="./procure.js"></script>
</body>
</html>
